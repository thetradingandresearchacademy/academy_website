<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Member Dashboard</title>
  <link rel="stylesheet" href="style.css">

  <!-- AUTH + SESSION CHECK -->
  <script>
    const params = new URLSearchParams(window.location.search);

    if (params.get("login") === "success") {
      localStorage.setItem("email", params.get("email"));
      localStorage.setItem("role", params.get("role"));
      localStorage.setItem("login_time", Date.now().toString());
      window.history.replaceState({}, document.title, "dashboard.html");
    }

    const SESSION_DURATION = 60 * 60 * 1000;
    const loginTime = localStorage.getItem("login_time");
    const role = localStorage.getItem("role");

    if (!loginTime || !role) {
      window.location.href = "login.html";
    } else if (Date.now() - parseInt(loginTime) > SESSION_DURATION) {
      localStorage.clear();
      alert("Session expired. Please login again.");
      window.location.href = "login.html";
    }

    function logout() {
      localStorage.clear();
      window.location.href = "login.html";
    }
  </script>

  <style>
    .dash-container { max-width:1100px; margin:auto; padding:20px; }
    .cards { display:grid; grid-template-columns:repeat(auto-fit,minmax(220px,1fr)); gap:15px; }
    .dash-card { background:#111827; padding:18px; border-radius:10px; border:1px solid #1f2933; }
    .dash-card h4 { margin-bottom:8px; }
    .dash-card span { color:#00d084; font-size:13px; display:inline-block; margin-top:10px; }
  </style>
</head>

<body>

<!-- FLOATING LOGOUT (GUARANTEED VISIBLE) -->
<div style="position:fixed;top:12px;right:16px;z-index:9999;">
  <button onclick="logout()"
    style="background:#ff4d4f;color:#fff;border:none;padding:8px 14px;
    border-radius:6px;cursor:pointer;font-size:14px;">
    Logout
  </button>
</div>

<div class="dash-container">
  <h2>Good Evening, Trader ğŸ‘‹</h2>
  <p style="color:#9ca3af;">Hereâ€™s your structured market view.</p>

  <div class="cards">

    <div class="dash-card">
      <h4>ğŸ“Š Todayâ€™s Market Bias</h4>
      <p>Bullish â€¢ Controlled risk</p>
      <span>View â†’</span>
    </div>

    <div class="dash-card weekly-card">
      <h4>ğŸ§  Weekly Context</h4>
      <p>Trend & swing structure</p>
      <span>Members â†’</span>
    </div>

    <div class="dash-card monthly-card">
      <h4>ğŸ“† Monthly Perspective</h4>
      <p>Big picture planning</p>
      <span>Premium â†’</span>
    </div>

    <div class="dash-card admin-card">
      <h4>ğŸ” Admin Notes</h4>
      <p>Internal research</p>
      <span>Admin Only â†’</span>
    </div>

  </div>
</div>

<!-- ROLE-BASED VISIBILITY -->
<script>
  const r = localStorage.getItem("role");

  document.querySelector(".weekly-card").style.display = "none";
  document.querySelector(".monthly-card").style.display = "none";
  document.querySelector(".admin-card").style.display = "none";

  if (r === "premium") {
    document.querySelector(".weekly-card").style.display = "block";
    document.querySelector(".monthly-card").style.display = "block";
  }

  if (r === "admin") {
    document.querySelector(".weekly-card").style.display = "block";
    document.querySelector(".monthly-card").style.display = "block";
    document.querySelector(".admin-card").style.display = "block";
  }
</script>

</body>
</html>